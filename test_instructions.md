## Инструкция по тестированию нового функционала

### 1. Запуск бэкенда FastAPI локально

1.  Убедитесь, что вы находитесь в корне проекта (`/home/haku/iXe`).
2.  Активируйте виртуальное окружение:
    ```bash
    source venv/bin/activate
    ```
3.  Запустите FastAPI приложение с помощью `uvicorn`. Укажите путь к вашей функции создания приложения, например `api.core_api:create_core_app` (предполагая, что `db_manager`, `storage`, `checker` инициализируются внутри). Если они передаются как зависимости, вам нужно создать скрипт, который инициализирует зависимости и передаст их в `create_core_app`, а затем запустит этот скрипт.
    Пример (если зависимости передаются напрямую в скрипте `main.py` или `api/core_api.py`):
    ```bash
    uvicorn api.core_api:app --reload --host 0.0.0.0 --port 8000
    ```
    *Примечание:* В реальной реализации `create_core_app` должен быть вызван с необходимыми зависимостями. Возможно, потребуется создать `main.py` для бэкенда, который инициализирует `db_manager` и другие компоненты и передаст их в `create_core_app`.

### 2. Тестирование эндпоинта `/api/v1/block/{problem_id}`

После запуска бэкенда:

*   **Через UI FastAPI (Swagger UI):**
    1.  Откройте браузер и перейдите по адресу `http://127.0.0.1:8000/docs`.
    2.  Найдите эндпоинт `GET /api/v1/block/{problem_id}` в списке.
    3.  Нажмите "Try it out".
    4.  В поле `problem_id` введите известный `problem_id` из базы, например, `init_40B442`.
    5.  Нажмите "Execute".
    6.  Проверьте вкладку "Response", чтобы увидеть возвращаемый HTML и статус-код (ожидается 200 для успешного запроса, 404 если задача не найдена).

*   **Через `curl`:**
    1.  В новом терминале (не останавливая `uvicorn`) выполните команду:
        ```bash
        curl -X GET "http://127.0.0.1:8000/api/v1/block/init_40B442" -H "accept: text/html"
        ```
    2.  В терминале должен отобразиться сгенерированный HTML-блок. Проверьте его структуру, наличие `processed_qblock`, `data-task-id`, `data-form-id`, `answer-form` и т.д.

### 3. Запуск фронтенда

*   **Если используете Vite для разработки:**
    1.  Откройте новый терминал и перейдите в папку `/home/haku/iXe/frontend`.
    2.  Убедитесь, что зависимости установлены: `npm install`.
    3.  Запустите сервер разработки: `npm run dev`. Это обычно запускает Vite на `http://localhost:5173`.

*   **Если используете `npx serve` для собранной версии:**
    1.  Убедитесь, что вы собрали проект: `npm run build` (в папке `/home/haku/iXe/frontend`). Это создаст папку `dist`.
    2.  Запустите сервер: `npx serve -s dist`.
    3.  Приложение будет доступно, обычно на `http://localhost:3000`.

### 4. Открытие `CalibrationPage` и использование DevTools

1.  Откройте браузер и перейдите на адрес фронтенда (например, `http://localhost:5173` или `http://localhost:3000`).
2.  Перейдите на страницу `/math/calibrate` (обычно через навигацию: Главное меню -> Математика -> Калибровка навыков).
3.  Нажмите `F12`, чтобы открыть DevTools.

*   **Вкладка Network:**
    1.  Перезагрузите страницу `CalibrationPage`.
    2.  Найдите запросы, начинающиеся с `/api/v1/block/` (или полный URL, если вы используете внешний бэкенд).
    3.  Проверьте статус-код (должен быть 200 OK).
    4.  Нажмите на один из таких запросов, перейдите на вкладку "Response" и убедитесь, что тело ответа содержит ожидаемый HTML-блок.

*   **Вкладка Console:**
    1.  Проверьте наличие ошибок JavaScript (красные строки `Error`).
    2.  Проверьте наличие логов, которые вы добавили в `CalibrationPage.tsx` (синие/серые строки `Log`), например, при загрузке блоков или обработке ответов.

*   **Вкладка Elements:**
    1.  Найдите элементы, соответствующие блокам заданий (обычно `div` с классом `processed_qblock`).
    2.  Проверьте, что у них есть атрибуты `data-task-id` и `data-form-id` с правильными значениями.
    3.  Убедитесь, что внутри них находятся элементы формы, поля ввода (`input#answer_...`), кнопки и т.д.

### 5. Проверка функциональности

*   **`MathJax`:**
    1.  Найдите элементы с математическими выражениями (например, `span.MathJax`, `span.math`).
    2.  Убедитесь, что они визуально отображаются как правильно отформатированные формулы, а не как исходный код LaTeX/MathML.

*   **Кнопки:**
    1.  **Кнопка "i" (информация):** Нажмите на неё. Должна появиться/исчезнуть панель с информацией о задании.
    2.  **Кнопка "Показать/скрыть математические символы":** Нажмите. Должны появиться/исчезнуть кнопки с символами.
    3.  **Кнопки математических символов:** Нажмите на один из них (например, `+`, `π`). Символ должен вставиться в поле ввода ответа.

*   **Отправка ответа:**
    1.  Введите ответ в поле ввода.
    2.  Нажмите кнопку "Отправить ответ".
    3.  В DevTools на вкладке Network должен появиться запрос к `https://ixe-core.onrender.com/answer`.
    4.  В DevTools на вкладке Console должны появиться логи об обработке ответа.
    5.  Рядом с полем ввода должен обновиться статус ("Проверка...", "ВЕРНО", "НЕВЕРНО").

### 6. Типичные ошибки и диагностика

*   **`task_id` не совпадает:**
    *   **Симптом:** Запрос к `/answer` отправляется с неправильным `problem_id`, проверка не проходит.
    *   **Диагностика:** В DevTools Network проверьте тело запроса к `/answer`. Убедитесь, что `problem_id` совпадает с `data-task-id` из HTML-блока. В `CalibrationPage.tsx` проверьте, как извлекается `taskId`.
*   **`MathJax` не находит формулы:**
    *   **Симптом:** Формулы отображаются как код.
    *   **Диагностика:** Убедитесь, что MathJax подключен в `index.html`. Проверьте, что `window.MathJax` определён в DevTools Console. Проверьте, что `MathJax.Hub.Queue(['Typeset', ...])` вызывается *после* вставки HTML блоков (в `useEffect`).
*   **`insertSymbol` не находит `input`:**
    *   **Симптом:** Нажатие кнопки символа не вставляет символ.
    *   **Диагностика:** В DevTools Console проверьте, определена ли `window.insertSymbol`. Убедитесь, что `blockIndex`, передаваемый в `insertSymbol`, совпадает с `id` поля ввода (например, `answer_0`, `answer_1`). Проверьте, что поле ввода (`input#answer_...`) действительно существует в DOM (вкладка Elements).
*   **Белая страница на `CalibrationPage`:**
    *   **Симптом:** Страница пустая.
    *   **Диагностика:** Проверьте вкладку Console на наличие фатальных ошибок JavaScript, которые могут прервать рендер. Проверьте Network, были ли запросы к `/api/v1/block/...`, и успешны ли они. Проверьте, срабатывает ли `useEffect` загрузки блоков.
