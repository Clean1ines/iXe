# ADR 002: Создание общей библиотеки (common)

## Статус
Принято

## Контекст
В проекте наблюдается дублирование кода, моделей данных (например, `Problem`, `DBProblem`) и утилит (например, `subject_mapping`, `task_number_inferer`) между различными частями системы: скрапером (`scraper/`), веб-API (`api/`), сервисами (`services/`, `utils/`), процессорами (`processors/`) и скриптами (`scripts/`). Также процессоры (`processors/`), зависящие от BrowserManager/Playwright, не были перенесены в `common`. Это приводит к:
- Сложности поддержки: изменение в одной копии кода требует синхронизации с другими.
- Риску десинхронизации: разные части системы могут использовать разные версии одной логики.
- Увеличению размера кодовой базы.

## Решение
Ввести общую библиотеку `common/` в составе текущего репозитория (monorepo). Перенести в неё все общие компоненты, удовлетворяющие критериям включения (см. `docs/development/common-library-guidelines.md`), исключая компоненты с тяжёлыми зависимостями (например, процессоры, зависящие от BrowserManager/Playwright). Установить `common/` как редактируемый пакет (`pip install -e common/`) для обеспечения корректного разрешения импортов в проекте.

### Альтернативы
- **Git Submodules:** Сложнее для настройки и новичков, может нарушать линейность истории при совместной разработке.
- **Копирование файлов:** Явно нарушает цель устранения дублирования.
- **Отдельный пакет (pip install с github/git):** Усложнит CI/CD и локальную разработку при одновременном изменении основного кода и `common`.

## Последствия
### Плюсы
- Единая модель данных (`Problem`, `DBProblem`) и бизнес-логики (`subject_mapping`, `task_number_inferer`) для всего проекта.
- Упрощение рефакторинга общих компонентов.
- Централизованное управление общими зависимостями (указанными в `common/setup.py`).
- Уменьшение дублирования кода для компонентов, подходящих для common.

### Минусы
- Необходимость строгого соблюдения правил включения в `common` для избежания циклических зависимостей и нарушения архитектуры.
- Изменения в `common` потенциально могут повлиять на несколько сервисов сразу, требуя более тщательного тестирования. Компоненты, не подходящие для common, остаются в своих оригинальных местах.
