# Обзор архитектуры

Проект изначально был монолитным, но с введением `common` библиотеки и разделением зависимостей, архитектура эволюционировала в сторону микросервисов.

## Текущая архитектура (в процессе перехода)

Проект организован как монорепозиторий с центральной библиотекой `common`, содержащей общие компоненты. Это позволяет избежать дублирования кода между различными *частями* системы и является промежуточным шагом к полной микросервисной архитектуре.

### Структура

- `api/`: FastAPI приложение, предоставляющее REST API для фронтенда. Зависит от `common`. **Использует `requirements_web.txt`.**
- `scraper/`: Компонент для скрапинга данных с сайта FIPI. Зависит от `common`. **Часть логики может быть вынесена в отдельный сервис. Использует `requirements_scraping_checking.txt`.**
- `scripts/`: Вспомогательные скрипты (миграция, индексация и т.д.). Зависит от `common`.
- `common/`: Общая библиотека, содержащая:
  - `models/`: Pydantic и SQLAlchemy модели. Используются всеми компонентами.
  - `utils/`: Stateless утилиты (например, `subject_mapping`, `model_adapter`). Используются всеми компонентами.
  - `processors/`: Обработчики данных (независимые от BrowserManager/Playwright). Используются компонентами, обрабатывающими данные.
  - `services/`: Общая бизнес-логика (например, `SpecificationService`). Используется API и другими компонентами.
  - `config/`: Конфигурационные файлы (например, `task_number_rules.json`).
- `frontend/`: Клиентская часть (PWA).
- `data/`: Локальные данные (базы данных, файлы задач).
- `docs/`: Документация.
- `utils/`: Вспомогательные утилиты, *потенциально зависящие* от BrowserManager/Playwright или логики, специфичной для монолита. **Часть файлов (например, `browser_manager.py`, `answer_checker.py`) тянет за собой тяжелые зависимости и является кандидатом для изоляции или выноса в отдельный сервис.**
- `models/`: Модели данных. **Часть файлов была перенесена в `common/models/`. Остальные файлы остаются здесь, возможно, для обратной совместимости или специфичной логики.**
- `processors/`: Процессоры данных. **Часть файлов, не зависящих от BrowserManager/Playwright, была перенесена в `common/processors/`. Остальные файлы остаются здесь.**
- `services/`: Сервисы. **Часть файлов была перенесена в `common/services/`. Остальные файлы остаются здесь, возможно, для специфичной бизнес-логики или как адаптеры для микросервисов.**

### Взаимодействие

Компоненты (`api`, `scraper`, `scripts`) импортируют общие модели и утилиты из `common`. Это обеспечивает согласованность данных и уменьшает дублирование. Файлы в старых директориях (`utils/`, `models/`, `processors/`, `services/`), которые не были перенесены, могут зависеть от `common` или выполнять логику, специфичную для старой архитектуры или зависящую от `BrowserManager`/`Playwright`.

## План перехода к микросервисам

1.  **Web API Service**: Содержит `api/`, `run.py`, `services/quiz_service_adapter.py`. Зависит от `common`. Использует `requirements_web.txt`. **Цель: Запуск на Render Free tier.**
2.  **Scraping & Checking Service**: Потенциально объединяет `scraper/`, `utils/answer_checker.py`, `utils/browser_manager.py`, `scripts/scrape_tasks.py`. Зависит от `common`. Использует `requirements_scraping_checking.txt`. **Цель: Изолировать `playwright` и логику проверки ответов.**
3.  **Indexing Service**: Потенциально объединяет `utils/vector_indexer.py`, `scripts/index_problems.py`. Зависит от `common`. Использует `requirements_indexing.txt`. **Цель: Изолировать `qdrant-client` и логику индексации.**

