
#### **Задача 14: Обновить `api/endpoints/quiz.py`, использовать `common`. (Детализация)**

**Цель:** Обновить эндпоинты викторины.

**Действия:**

1.  **Копирование `api/endpoints/quiz.py` в `web-api-service`:**
    *   **Команда:** `cp api/endpoints/quiz.py web-api-service/api/endpoints/`
    *   **Обновление импортов в `api/endpoints/quiz.py`:**
        ```python
        from fastapi import APIRouter, Depends, HTTPException
        from web_api_service.services.quiz_service import QuizService # Импортируем из web-api-service
        from common.models.pydantic_models import StartQuizRequest, StartQuizResponse, GetNextTaskResponse # Импортируем из common
        from api.dependencies import get_quiz_service, require_subscription # Импортируем зависимости из web-api-service
        import logging

        logger = logging.getLogger(__name__)

        router = APIRouter()

        @router.post("/quiz/start", response_model=StartQuizResponse)
        async def start_quiz_endpoint(
            request: StartQuizRequest,
            quiz_service: QuizService = Depends(get_quiz_service),
            _: bool = Depends(require_subscription) # Проверка подписки
        ) -> StartQuizResponse:
            try:
                # Вызвать сервис
                result = await quiz_service.start_quiz(user_id=request.user_id, request=request)
                return result
            except Exception as e:
                logger.error(f"Error in start_quiz_endpoint: {e}")
                raise HTTPException(status_code=500, detail="Internal server error during quiz start")

        @router.get("/quiz/next/{session_id}", response_model=GetNextTaskResponse)
        async def get_next_task_endpoint(
            session_id: str,
            quiz_service: QuizService = Depends(get_quiz_service),
            _: bool = Depends(require_subscription) # Проверка подписки
        ) -> GetNextTaskResponse:
            try:
                # Вызвать сервис
                result = await quiz_service.get_next_task(session_id=session_id)
                return GetNextTaskResponse(problem=result) # Обернуть задачу в ответ, если нужно
            except Exception as e:
                logger.error(f"Error in get_next_task_endpoint: {e}")
                raise HTTPException(status_code=500, detail="Internal server error during getting next task")
        ```

2.  **Копирование `common` в `web-api-service` (если не копируется в Dockerfile):**
    *   **Команда:** `cp -r common web-api-service/`

**Acceptance:**

*   Файл `web-api-service/api/endpoints/quiz.py` обновлен.
*   Он импортирует `QuizService` из `web-api-service/services/quiz_service.py`.
*   Он импортирует `StartQuizRequest`, `StartQuizResponse`, `GetNextTaskResponse` из `common.models.pydantic_models`.
*   Он импортирует `get_quiz_service`, `require_subscription` из `web-api-service/api/dependencies.py`.
*   Эндпоинты (`/quiz/start`, `/quiz/next/{session_id}`) используют `QuizService` и проверяют подписку.

---

*   **Задача 14 (обновленная): Обновить `api/endpoints/quiz.py`.**
    *   **Дополнительное действие:** После обновления `api/endpoints/quiz.py`:
        *   **Тесты (Integration):** `web-api-service/tests/integration/test_api/test_quiz_endpoint.py`
            *   Использовать `TestClient`.
            *   Мокировать `QuizService`.
            *   Проверить эндпоинты `/quiz/start`, `/quiz/next/{session_id}`.
        *   **Acceptance:** Эндпоинты викторины покрыты интеграционными тестами.

Задача 14 (обновленная): Обновить api/endpoints/quiz.py.
Дополнительное действие (Документирование):
Обновить docstrings в quiz.py: Описать эндпоинты /quiz/start, /quiz/next.
Обновить docs/api/web-api-openapi.json.
Обновить docs/api/web-api-reference.md.
Acceptance (Документирование):
quiz.py содержит подробные docstrings.
OpenAPI-спецификация и/или справочник API обновлены.

